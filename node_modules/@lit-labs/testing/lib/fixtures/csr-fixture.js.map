{"version":3,"file":"csr-fixture.js","sourceRoot":"","sources":["../../src/lib/fixtures/csr-fixture.ts"],"names":[],"mappings":"AAAA;;;;GAIG;AAEH,OAAO,EAAC,MAAM,EAAC,MAAM,KAAK,CAAC;AAC3B,OAAO,EAAC,SAAS,EAAC,MAAM,aAAa,CAAC;AACtC,OAAO,EAAC,eAAe,EAAC,MAAM,sBAAsB,CAAC;AAKrD;;GAEG;AACH,MAAM,CAAC,KAAK,UAAU,UAAU,CAC9B,QAAwB,EACxB,EAAC,OAAO,EAAE,IAAI,EAAiB;IAE/B,IAAI,IAAI,KAAK,SAAS,EAAE,CAAC;QACvB,6CAA6C;QAC7C,UAAU;QACV,QAAQ;QACR,wGAAwG;QACxG,gHAAgH;QAChH,8GAA8G;QAC9G,EAAE;QACF,WAAW;QACX,mGAAmG;QACnG,2GAA2G;QAC3G,4FAA4F;QAC5F,EAAE;QACF,UAAU;QACV,yFAAyF;QACzF,oCAAoC;QACpC,oCAAoC;QACpC,4FAA4F;QAC5F,MAAM,EAAC,KAAK,EAAC,GAAG,IAAI,KAAK,EAAE,CAAC;QAC5B,MAAM,KAAK,GAAG,KAAK,EAAE,KAAK,CAAC,0CAA0C,CAAC,CAAC;QACvE,IAAI,CAAC,KAAK,EAAE,CAAC;YACX,MAAM,IAAI,KAAK,CACb,sDAAsD,KAAK,EAAE,CAC9D,CAAC;QACJ,CAAC;QACD,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;IAClB,CAAC;IAED,MAAM,SAAS,GAAG,eAAe,EAAE,CAAC;IAEpC,MAAM,OAAO,CAAC,GAAG,CACf,OAAO,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC,MAAM,CAAC,IAAI,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,CAC5D,CAAC;IAEF,MAAM,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;IAE5B,MAAM,EAAE,GAAG,SAAS,CAAC,iBAAiB,CAAC;IAEvC,MAAM,CAAE,EAAiB,EAAE,cAAc,IAAI,SAAS,EAAE,CAAC,CAAC;IAE1D,OAAO,EAAO,CAAC;AACjB,CAAC","sourcesContent":["/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport {render} from 'lit';\nimport {nextFrame} from '../utils.js';\nimport {createContainer} from './fixture-wrapper.js';\n\nimport type {LitElement, TemplateResult} from 'lit';\nimport type {FixtureOptions} from './fixture-options.js';\n\n/**\n * Renders the provided Lit template client-side.\n */\nexport async function csrFixture<T extends HTMLElement>(\n  template: TemplateResult,\n  {modules, base}: FixtureOptions\n): Promise<T> {\n  if (base === undefined) {\n    // Find the test file url from the call stack\n    // Chrome:\n    // Error\n    // at ssrFixture (http://localhost:8000/node_modules/@lit-labs/testing/lib/fixtures/ssrFixture.js:29:17)\n    // at ssrHydratedFixture (http://localhost:8000/node_modules/@lit-labs/testing/lib/fixtures/ssrFixture.js:76:12)\n    // at o.<anonymous> (http://localhost:8000/test/my-element_test.js?wtr-session-id=GhB4vW1TXWxXwqgt3F8QD:65:30)\n    //\n    // Firefox:\n    // ssrFixture@http://localhost:8000/node_modules/@lit-labs/testing/lib/fixtures/ssrFixture.js:29:17\n    // ssrHydratedFixture@http://localhost:8000/node_modules/@lit-labs/testing/lib/fixtures/ssrFixture.js:76:12\n    // @http://localhost:8000/test/my-element_test.js?wtr-session-id=NaCljZAFiyeOoV6-qBqwr:65:30\n    //\n    // Webkit:\n    // @http://localhost:8000/node_modules/@lit-labs/testing/lib/fixtures/ssrFixture.js:29:26\n    // asyncFunctionResume@[native code]\n    // asyncFunctionResume@[native code]\n    // @http://localhost:8000/test/my-element_test.js?wtr-session-id=aKWON-wBOBGyzb2CwIvmK:65:37\n    const {stack} = new Error();\n    const match = stack?.match(/http:\\/\\/localhost.+(?=\\?wtr-session-id)/);\n    if (!match) {\n      throw new Error(\n        `Could not find call site for csrFixture in stack:\\n${stack}`\n      );\n    }\n    base = match[0];\n  }\n\n  const container = createContainer();\n\n  await Promise.all(\n    modules.map((module) => import(new URL(module, base).href))\n  );\n\n  render(template, container);\n\n  const el = container.firstElementChild;\n\n  await ((el as LitElement)?.updateComplete || nextFrame());\n\n  return el as T;\n}\n"]}